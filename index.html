<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<script src="./dist/timeless.core.umd.min.js"></script>
	<script src="./dist/timeless.web.umd.min.js"></script>
	<style>
		#editor {
			border: 2px solid #ccc;
			padding: 4px;
			width: 240px;
			height: 480px;
			border-radius: 12px;
		}

		#editor:focus {}
	</style>
</head>

<body>
	<div id="editor" contenteditable="true" autocapitalize="off" autocorrect="off"></div>
	<script>
		const $elm = document.querySelector('#editor');
		const slate$ = Timeless.SlateEditorModel({
			defaultValue: [
				{
					type: 'paragraph',
					children: [{ type: 'text', text: '' }],
				}
			]
		})
		slate$.onAction((operations) => {
			for (let i = 0; i < operations.length; i += 1) {
				const op = operations[i];
				Timeless.SlateDOM.exec($elm, op);
			}
		});
		slate$.onSelectionChange(({ type, start, end }) => {
			Timeless.SlateDOM.refreshSelection($elm, start, end);
		});
		// @ts-ignore
		TimelessWeb.provide_slate(slate$, $elm);
		console.log("[]SlateEditor - state.children", slate$.state.children);
		const $slate_content = Timeless.SlateDOM.buildInnerHTML(
			slate$.state.children
		);
		console.log("[]SlateEditor - buildInnerHTML result", $slate_content);
		console.log("[]SlateEditor - $slate_content.childNodes", $slate_content.childNodes.length);
		while ($elm.firstChild) {
			$elm.removeChild($elm.firstChild);
		}
		$elm.appendChild($slate_content);
		console.log("[]SlateEditor - $elm.innerHTML after append", $elm.innerHTML);
		// 初始化选区
		const selection = window.getSelection();
		if (selection) {
			selection.removeAllRanges();
		}
		Timeless.SlateDOM.refreshSelection($elm, { path: [0, 0], offset: 0 }, { path: [0, 0], offset: 0 });
	</script>
</body>

</html>